{
    "name": "V8.0 å¿ƒè·³ç›‘æ§å·¥ä½œæµ",
    "nodes": [
        {
            "parameters": {
                "rule": {
                    "interval": [
                        {
                            "field": "cronExpression",
                            "expression": "10 9 * * 1-5"
                        }
                    ]
                },
                "options": {
                    "timezone": "Asia/Shanghai"
                }
            },
            "id": "55eff146-43cc-4116-9834-ae202706431a",
            "name": "æ¯æ—¥09:10è§¦å‘ (å·¥ä½œæ—¥å¼€ç›˜å‰)",
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.2,
            "position": [
                200,
                300
            ]
        },
        {
            "parameters": {
                "url": "https://jpthermjdexc.ap-northeast-1.clawcloudrun.com/health",
                "options": {
                    "timeout": 30000
                }
            },
            "id": "40451dc7-5de4-40ca-908a-a7f263b4afbb",
            "name": "è°ƒç”¨ /health ç«¯ç‚¹",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                420,
                300
            ],
            "retryOnFail": true,
            "maxTries": 3,
            "waitBetweenTries": 5000,
            "alwaysOutputData": true,
            "onError": "continueRegularOutput"
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict"
                    },
                    "conditions": [
                        {
                            "id": "status-check",
                            "leftValue": "={{ $json.status }}",
                            "rightValue": "healthy",
                            "operator": {
                                "type": "string",
                                "operation": "notEquals"
                            }
                        }
                    ],
                    "combinator": "or"
                },
                "options": {}
            },
            "id": "check-status-001",
            "name": "æ£€æŸ¥çŠ¶æ€æ˜¯å¦å¼‚å¸¸",
            "type": "n8n-nodes-base.if",
            "typeVersion": 2,
            "position": [
                640,
                300
            ]
        },
        {
            "parameters": {
                "mode": "runOnceForEachItem",
                "jsCode": "// ç›´æ¥ä» HTTP è¯·æ±‚èŠ‚ç‚¹è·å–æ•°æ®\nlet data = {};\ntry {\n    data = $('è°ƒç”¨ /health ç«¯ç‚¹').first().json;\n} catch (e) {\n    data = $json;\n}\n\nconst status = data.status || 'æœªçŸ¥';\nconst timestamp = data.timestamp || new Date().toISOString();\nconst latencyMs = data.latency_ms || 0;\nconst errorCount = data.checks?.circuit_breaker?.error_count || 0;\nconst isOpen = data.checks?.circuit_breaker?.is_open || false;\n\nconst cardContent = [\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: `**çŠ¶æ€**: ${status}\\n**æ—¶é—´**: ${timestamp}\\n**å»¶è¿Ÿ**: ${latencyMs}ms`\n    }\n  },\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: `**ç†”æ–­å™¨é”™è¯¯**: ${errorCount} æ¬¡\\n**å·²è§¦å‘ç†”æ–­**: ${isOpen}`\n    }\n  },\n  { tag: 'hr' },\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: 'âš ï¸ è¯·ç«‹å³æ£€æŸ¥ API æœåŠ¡çŠ¶æ€'\n    }\n  }\n];\n\nreturn {\n  json: {\n    card_color: 'red',\n    card_content: cardContent,\n    header_title: 'ğŸ”´ ç³»ç»Ÿå¥åº·è­¦æŠ¥'\n  }\n};"
            },
            "id": "build-alert-card",
            "name": "æ„å»ºå‘Šè­¦å¡ç‰‡",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                860,
                200
            ],
            "alwaysOutputData": true
        },
        {
            "parameters": {
                "resource": "message",
                "operation": "message:send",
                "receive_id_type": "user_id",
                "receive_id": "bg99a8dc",
                "msg_type": "interactive",
                "content": "={{\nJSON.stringify({\n  \"config\": {\n    \"wide_screen_mode\": true\n  },\n  \"header\": {\n    \"template\": $json.card_color,\n    \"title\": {\n      \"content\": $json.header_title,\n      \"tag\": \"plain_text\"\n    }\n  },\n  \"elements\": $json.card_content\n})\n}}"
            },
            "id": "send-alert-feishu",
            "name": "å‘é€é£ä¹¦å‘Šè­¦",
            "type": "n8n-nodes-feishu-lite.feishuNode",
            "typeVersion": 1,
            "position": [
                1080,
                200
            ],
            "alwaysOutputData": true,
            "retryOnFail": true,
            "maxTries": 3,
            "waitBetweenTries": 2000,
            "credentials": {
                "feishuCredentialsApi": {
                    "id": "RcP0KB4O5l2Y95Bs",
                    "name": "Feishu account 2"
                }
            },
            "onError": "continueRegularOutput"
        },
        {
            "parameters": {
                "mode": "runOnceForEachItem",
                "jsCode": "// ç›´æ¥ä» HTTP è¯·æ±‚èŠ‚ç‚¹è·å–æ•°æ®\nlet data = {};\ntry {\n    data = $('è°ƒç”¨ /health ç«¯ç‚¹').first().json;\n} catch (e) {\n    data = $json;\n}\n\nconst status = data.status || 'æœªçŸ¥';\nconst timestamp = data.timestamp || new Date().toISOString();\nconst latencyMs = data.latency_ms || 0;\nconst version = data.version || 'unknown';\n\nconst cardContent = [\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: `**çŠ¶æ€**: ${status} âœ…\\n**æ—¶é—´**: ${timestamp}\\n**å»¶è¿Ÿ**: ${latencyMs}ms`\n    }\n  },\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: `**ç‰ˆæœ¬**: ${version}`\n    }\n  },\n  { tag: 'hr' },\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: 'âœ… ç³»ç»Ÿè¿è¡Œæ­£å¸¸'\n    }\n  }\n];\n\nreturn {\n  json: {\n    card_color: 'green',\n    card_content: cardContent,\n    header_title: 'ğŸŸ¢ ç³»ç»Ÿå¥åº·æŠ¥å‘Š'\n  }\n};"
            },
            "id": "build-healthy-card",
            "name": "æ„å»ºæ­£å¸¸å¡ç‰‡",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                860,
                400
            ],
            "alwaysOutputData": true
        },
        {
            "parameters": {
                "resource": "message",
                "operation": "message:send",
                "receive_id_type": "user_id",
                "receive_id": "bg99a8dc",
                "msg_type": "interactive",
                "content": "={{\nJSON.stringify({\n  \"config\": {\n    \"wide_screen_mode\": true\n  },\n  \"header\": {\n    \"template\": $json.card_color,\n    \"title\": {\n      \"content\": $json.header_title,\n      \"tag\": \"plain_text\"\n    }\n  },\n  \"elements\": $json.card_content\n})\n}}"
            },
            "id": "send-healthy-feishu",
            "name": "å‘é€æ­£å¸¸é€šçŸ¥",
            "type": "n8n-nodes-feishu-lite.feishuNode",
            "typeVersion": 1,
            "position": [
                1080,
                400
            ],
            "alwaysOutputData": true,
            "retryOnFail": true,
            "maxTries": 3,
            "waitBetweenTries": 2000,
            "credentials": {
                "feishuCredentialsApi": {
                    "id": "RcP0KB4O5l2Y95Bs",
                    "name": "Feishu account 2"
                }
            },
            "onError": "continueRegularOutput"
        }
    ],
    "connections": {
        "æ¯æ—¥09:10è§¦å‘ (å·¥ä½œæ—¥å¼€ç›˜å‰)": {
            "main": [
                [
                    {
                        "node": "è°ƒç”¨ /health ç«¯ç‚¹",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "è°ƒç”¨ /health ç«¯ç‚¹": {
            "main": [
                [
                    {
                        "node": "æ£€æŸ¥çŠ¶æ€æ˜¯å¦å¼‚å¸¸",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "æ£€æŸ¥çŠ¶æ€æ˜¯å¦å¼‚å¸¸": {
            "main": [
                [
                    {
                        "node": "æ„å»ºå‘Šè­¦å¡ç‰‡",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "æ„å»ºæ­£å¸¸å¡ç‰‡",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "æ„å»ºå‘Šè­¦å¡ç‰‡": {
            "main": [
                [
                    {
                        "node": "å‘é€é£ä¹¦å‘Šè­¦",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "æ„å»ºæ­£å¸¸å¡ç‰‡": {
            "main": [
                [
                    {
                        "node": "å‘é€æ­£å¸¸é€šçŸ¥",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "settings": {
        "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
        "templateCredsSetupCompleted": true
    },
    "pinData": {},
    "versionId": "v8.0-heartbeat-v4",
    "triggerCount": 0,
    "tags": []
}
